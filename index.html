<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.7, maximum-scale=1.7, user-scalable=no">

<title>🛰 JTT portal🛰</title>
<meta name="theme-color" content="#00eaff">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#00eaff">
<link rel="icon" href="icons/icon-192.png">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* Écran de chargement */
.splash-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-dark);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.5s ease-out;
}

.splash-logo {
  font-size: 2rem;
  color: var(--blue-main);
  margin-bottom: 20px;
  animation: glowText 2s ease-in-out infinite;
}

.splash-text {
  font-family: "Orbitron", sans-serif;
  color: var(--gold-jtt);
  font-size: 1.5rem;
  text-transform: uppercase;
  animation: fadeIn 1s ease-out;
}

@keyframes glowText {
  0%, 100% { text-shadow: 0 0 10px var(--blue-main); }
  50% { text-shadow: 0 0 20px var(--blue-main), 0 0 30px var(--blue-main); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
</style>


<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js')
      .then(registration => {
        console.log('Service Worker registered');
      })
      .catch(err => {
        console.log('Service Worker registration failed:', err);
      });
  });
}
</script>



<style>
:root{
  --blue-main:#00eaff;
  --blue-dark:#062d37;
  --gold-jtt:#e1b46a;
  --text-light:#cbe4ef;
  --bg-dark:#010205;
}
body{
  margin:0;padding:0;
  font-family:"Orbitron",sans-serif;
  background:radial-gradient(circle at 20% 20%,#081625 0%,#040d17 100%);
  color:var(--text-light);
  display:flex;flex-direction:column;align-items:center;
  padding:18px;
}
h1{
  color:var(--blue-main);
  text-align:center;
  animation:glow 3s ease-in-out infinite;
  font-size:clamp(1rem,3vw,1.2rem);
  margin:18px 0;text-transform:uppercase;
}
@keyframes glow{
  0%,100%{text-shadow:0 0 6px var(--blue-main),0 0 10px var(--blue-main);}
  50%{text-shadow:0 0 18px var(--blue-main),0 0 26px var(--blue-main);}
}

.dashboard{
  width:96%;max-width:500px;
  background:linear-gradient(180deg,rgba(8,22,37,.95),rgba(4,13,23,.95));
  border:1.5px solid var(--blue-main);
  border-radius:12px;
  box-shadow:inset 0 0 20px rgba(0,239,255,.15),0 0 25px rgba(0,239,255,.3);
  padding:20px;margin-bottom:22px;
}
.section{
  background:rgba(2,15,20,.7);
  border-left:3px solid var(--blue-main);
  border-radius:8px;padding:15px;
  box-shadow:inset 0 0 8px rgba(0,234,255,.25);
}
.section h2{
  color:var(--gold-jtt);
  margin:0 0 10px;text-align:center;
  text-shadow:0 0 8px var(--blue-main);
  font-size:0.8rem;text-transform:uppercase;
}

.jauge-container{
  background:rgba(5,25,30,.4);
  border:1px solid var(--blue-dark);
  border-radius:6px;margin:10px 0;height:22px;position:relative;
}
.jauge-fill{
  background:linear-gradient(90deg,var(--blue-dark),var(--blue-main));
  height:100%;width:0%;transition:width 1.2s ease-in-out;
}
.jauge-text{
  position:absolute;inset:0;display:flex;
  align-items:center;justify-content:center;
  font-size:0.85em;color:#fff;text-shadow:0 0 6px var(--blue-main);
}

.submenu{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin-top:12px;}
.link{
  flex:1 1 45%;
  background:linear-gradient(90deg,var(--blue-dark),var(--blue-main));
  border-radius:8px;color:#fff;text-align:center;text-decoration:none;
  padding:10px 12px;font-weight:700;
  font-size:clamp(0.8rem,3.4vw,1rem);
  white-space:nowrap;
  box-shadow:0 0 10px rgba(0,234,255,.4);
  transition:.25s;
}
.link:hover{transform:scale(1.05);box-shadow:0 0 16px var(--blue-main);}
.btn-sync{
  display:block;margin:14px auto 0;
  background:none;border:1px solid var(--blue-main);
  color:var(--gold-jtt);border-radius:5px;
  padding:7px 14px;font-size:0.9rem;cursor:pointer;
}
.btn-sync:hover{background:var(--blue-main);color:#fff;box-shadow:0 0 10px var(--blue-main);}

.tabs{display:flex;justify-content:center;gap:10px;margin:12px 0;}
.tab{
  background:linear-gradient(90deg,#05283b,#07334a);
  color:#00eaff;border:none;cursor:pointer;font-weight:700;
  padding:8px 16px;border-radius:6px;text-transform:uppercase;
}
.tab.active{
  background:linear-gradient(90deg,#00eaff,#19b3fe);
  color:#02131f;box-shadow:0 0 15px rgba(0,239,255,0.4);
}
canvas{
  width:100%!important;
  height:auto!important;
  aspect-ratio:4/3;
  display:block;
  margin-top:8px;
  border-radius:8px;
  background:radial-gradient(rgba(0,234,255,0.05),rgba(0,234,255,0.02));
  padding:4px;
}
.summary{text-align:center;color:#77dfff;margin-top:12px;font-size:0.9rem;}
@media (max-width:420px){
  canvas{aspect-ratio:1/1;}
  .summary{font-size:0.8rem;}
}
footer{text-align:center;font-size:0.75rem;opacity:0.6;color:#00b7ff;margin:1rem 0;}
</style>
</head>

<body>
  <!-- Écran de chargement -->
  <div class="splash-screen" id="splashScreen">
    <div class="splash-logo">🛰</div>
    <div class="splash-text">JTT Portal</div>
  </div>

  <!-- Reste du contenu -->
  ...

<h1>🛰 JTT Alliance Management V3.6 🛰</h1>

<div class="dashboard">
  <div class="section">
    <h2>SHEET : ALLIANCE STATS</h2>
    <p style="text-align:center">Member census tracking. Data auto‑updated.</p>

    <div class="jauge-container">
      <div class="jauge-fill" id="fillBar"></div>
      <div class="jauge-text" id="fillText">Loading…</div>
    </div>

    <p style="text-align:center">
      <strong>Registered Members :</strong> <span id="count">--</span> / <span id="total">--</span>
    </p>

    <div class="submenu">
      <a class="link" href="https://forms.gle/VSXaijct8ebQFnYx5" target="_blank">📋 New Registration</a>
      <a class="link" href="https://docs.google.com/spreadsheets/d/1QMna4_NnamMeNUvU69dOOqwhIL07QgLlZ5mrKTU3xZs/edit?gid=483757800#gid=483757800" target="_blank">📊 JTT Data System</a>
      <a class="link" href="JTT_backup.html" target="_self">🎯 My Personal Link</a>
    </div>

    <button class="btn-sync" onclick="loadStats()">🔄 Refresh</button>
  </div>
</div>

<div class="dashboard">
  <div class="section">
    <h2>📈 GAME TIME MODELIZED – BROTHER IN ARM + SUM WAR POWER</h2>
    <div class="tabs">
      <button class="tab active" id="weeklyBtn">WEEKLY</button>
      <button class="tab" id="voidBtn">VOID</button>
    </div>
    <canvas id="chart"></canvas>
    <div class="summary" id="summary">Loading data...</div>
  </div>
</div>

<footer>© JTT Alliance Management V3.6</footer>

<script>
/* --- Alliance gauge: corrected member count --- */
async function loadStats(){
  try {
    const res = await fetch("https://docs.google.com/spreadsheets/d/1QMna4_NnamMeNUvU69dOOqwhIL07QgLlZ5mrKTU3xZs/gviz/tq?tqx=out:csv&gid=1508042555");
    const text = await res.text();
    const rows = text.trim().split("\n").map(r => r.split(",").map(c => c.replace(/(^"|"$)/g,"")));

    // ✅ Correction: parse all numeric values even with spaces or symbols
    const cleanNums = (rows[1] || [])
      .map(v => parseInt(String(v).replace(/\D/g,"") || "0", 10))
      .filter(n => !isNaN(n) && n > 0);

    const cur = cleanNums[0] || 0;
    const tot = cleanNums[1] || 100;
    const pct = Math.min(Math.round((cur/tot)*100),100);

    fillBar.style.width = pct + "%";
    fillText.textContent = pct + "% completed";
    count.textContent = cur;
    total.textContent = tot;
  } catch (e) {
    console.error("loadStats() error :", e);
    fillText.textContent = "❌ Data Error";
  }
}
loadStats();

/* --- Chart setup (identique) --- */
const ctx=document.getElementById('chart').getContext('2d');
const dataSets={weekly:{power:[],players:[]},void:{power:[],players:[]}};
const gradient=ctx.createLinearGradient(0,0,0,200);
gradient.addColorStop(0,"rgba(0,255,255,.25)");
gradient.addColorStop(1,"rgba(0,255,255,0)");
const chart=new Chart(ctx,{
  type:'line',
  data:{
    labels:Array.from({length:25},(_,i)=>i<24?`${i}h`:"24h"),
    datasets:[
      {label:"💪 Sum War Power (M)",data:[],
        borderColor:'#00ffee',backgroundColor:gradient,
        borderWidth:2,tension:0.25,fill:true,
        pointRadius:2,hoverRadius:4,pointBackgroundColor:'#00ffe0',yAxisID:'y'},
      {label:"👥 Brothers in Arm (Players)",data:[],
        borderColor:'#00bfff',backgroundColor:"rgba(0,255,255,.08)",
        borderWidth:1.8,tension:0.25,fill:true,
        pointRadius:2,hoverRadius:4,yAxisID:'y1'}
    ]
  },
  options:{
    responsive:true,maintainAspectRatio:true,
    layout:{padding:{left:5,right:5,top:5,bottom:5}},
    elements:{point:{radius:2},line:{borderWidth:2,tension:0.25}},
    plugins:{
      legend:{position:'bottom',labels:{color:'#00eaff',font:{size:9}}},
      tooltip:{
        backgroundColor:'#02131f',titleColor:'#00ffff',bodyColor:'#e1b46a',
        titleFont:{size:10},bodyFont:{size:9}}
    },
    scales:{
      x:{ticks:{color:'#66eaff',font:{size:8},maxRotation:0},
         grid:{color:'rgba(0,255,255,.05)'}},
      y:{beginAtZero:true,ticks:{color:'#00ffff',font:{size:8}},
         grid:{color:'rgba(0,255,255,.08)'}},
      y1:{position:'right',beginAtZero:true,
         ticks:{color:'#00ffff',font:{size:8}},
         grid:{drawOnChartArea:false}}
    }
  }
});

/* --- Google Sheets data --- */
async function getRange(gid,range){
  const u=`https://docs.google.com/spreadsheets/d/1QMna4_NnamMeNUvU69dOOqwhIL07QgLlZ5mrKTU3xZs/gviz/tq?tqx=out:json&gid=${gid}&range=${range}`;
  const res=await fetch(u);const txt=await res.text();
  const json=JSON.parse(txt.substring(47).slice(0,-2));
  return json.table.rows[0].c.map(c=>parseFloat(String(c?.v??0).replace(',','.'))||0);
}
async function initData(){
  const [W,V]=await Promise.all([
    Promise.all([getRange(0,'C127:AA127'),getRange(0,'C189:AA189')]),
    Promise.all([getRange(1434850621,'C127:AA127'),getRange(1434850621,'C189:AA189')])
  ]);
  dataSets.weekly={players:W[0],power:W[1].map(v=>v/1_000_000)};
  dataSets.void={players:V[0],power:V[1].map(v=>v/1_000_000)};
  switchData('weekly');
}
function switchData(mode){
  chart.data.datasets[0].data=dataSets[mode].power;
  chart.data.datasets[1].data=dataSets[mode].players;
  chart.update();
  updateSummary(mode);
}
function updateSummary(mode){
  const h=(new Date()).getUTCHours()%24;
  const p=dataSets[mode].power[h]||0;
  const b=dataSets[mode].players[h]||0;
  summary.textContent=`🕘 ${h}h UTC – Power ${p.toFixed(1)} M ⚡ Players ${b}`;
}
weeklyBtn.onclick=()=>{weeklyBtn.classList.add('active');voidBtn.classList.remove('active');switchData('weekly');};
voidBtn.onclick=()=>{voidBtn.classList.add('active');weeklyBtn.classList.remove('active');switchData('void');};
initData();
</script>
<script>
// Gestion de l'écran de chargement
window.addEventListener('load', () => {
  const splashScreen = document.getElementById('splashScreen');
  
  // Attendre un peu pour montrer l'animation
  setTimeout(() => {
    splashScreen.style.opacity = '0';
    setTimeout(() => {
      splashScreen.style.display = 'none';
    }, 500);
  }, 2000); // Affiche l'écran de chargement pendant 2 secondes
});
</script>
</body>
</html>
