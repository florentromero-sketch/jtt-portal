<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!-- ✅ Zoom natif équivalent user 175% -->
<meta name="viewport" content="width=device-width, initial-scale=1.75, maximum-scale=1.75, user-scalable=no">

<title>🛰 JTT Alliance Management 3.5</title>
<meta name="theme-color" content="#00eaff">

<!-- PWA manifest + icon -->
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===== Variables ===== */
:root{
  --blue-main:#00eaff;
  --blue-dark:#062d37;
  --gold-jtt:#e1b46a;
  --text-light:#cbe4ef;
  --bg-dark:#010205;
}

/* ===== Base ===== */
body{
  margin:0;padding:0;
  font-family:"Orbitron",sans-serif;
  font-size:1.05rem;
  line-height:1.45em;
  background:radial-gradient(circle at 20% 20%,#081625 0%,#040d17 100%);
  color:var(--text-light);
  display:flex;flex-direction:column;align-items:center;
  padding:18px;
}

h1{
  color:var(--blue-main);
  animation:glow 3s ease-in-out infinite;
  font-size:clamp(1rem,3vw,1.2rem);
  margin:18px 0;text-align:center;text-transform:uppercase;
}
@keyframes glow{
  0%,100%{text-shadow:0 0 6px var(--blue-main),0 0 10px var(--blue-main);}
  50%{text-shadow:0 0 18px var(--blue-main),0 0 26px var(--blue-main);}
}

/* ===== MAIN PANEL ===== */
.dashboard{
  width:96%;max-width:500px;
  background:linear-gradient(180deg,rgba(8,22,37,0.95) 0%,rgba(4,13,23,0.95) 100%);
  border:1.5px solid var(--blue-main);
  border-radius:12px;
  box-shadow:inset 0 0 20px rgba(0,239,255,0.15),0 0 25px rgba(0,239,255,0.3);
  padding:20px;margin-bottom:24px;
}
.section{
  background:rgba(2,15,20,.7);
  border-left:3px solid var(--blue-main);
  border-radius:8px;padding:16px;
  box-shadow:inset 0 0 8px rgba(0,234,255,.25);
}
.section h2{
  color:var(--gold-jtt);margin:0 0 10px;text-align:center;
  text-transform:uppercase;text-shadow:0 0 8px var(--blue-main);
  font-size:0.85rem;
}

/* ===== Progress bar ===== */
.jauge-container{
  background:rgba(5,25,30,.4);
  border:1px solid var(--blue-dark);
  border-radius:6px;margin:10px 0;height:22px;position:relative;overflow:hidden;
}
.jauge-fill{
  background:linear-gradient(90deg,var(--blue-dark),var(--blue-main));
  height:100%;width:0%;transition:width 1.2s ease-in-out;
}
.jauge-text{
  position:absolute;inset:0;display:flex;
  align-items:center;justify-content:center;
  font-size:0.85em;color:#fff;text-shadow:0 0 6px var(--blue-main);
}

/* ===== Buttons & Links ===== */
.submenu{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin-top:12px;}
.link{
  flex:1 1 45%;
  background:linear-gradient(90deg,var(--blue-dark),var(--blue-main));
  border-radius:8px;color:#fff;text-align:center;text-decoration:none;
  padding:10px 12px;font-weight:700;
  font-size:clamp(0.8rem,3.4vw,1rem);
  white-space:nowrap;
  box-shadow:0 0 10px rgba(0,234,255,.4);
  transition:.25s;
}
.link:hover{transform:scale(1.05);box-shadow:0 0 18px var(--blue-main);}

.btn-sync{
  display:block;margin:14px auto 0;
  background:none;border:1px solid var(--blue-main);
  color:var(--gold-jtt);
  border-radius:5px;padding:7px 14px;
  font-size:0.9rem;cursor:pointer;
}
.btn-sync:hover{background:var(--blue-main);color:#fff;box-shadow:0 0 10px var(--blue-main);}

/* ===== Chart ===== */
.tabs{display:flex;justify-content:center;gap:12px;margin:12px 0;}
.tab{
  background:linear-gradient(90deg,#05283b 0%,#07334a 100%);
  color:#00eaff;border:none;cursor:pointer;font-weight:700;
  padding:8px 16px;border-radius:6px;text-transform:uppercase;
}
.tab.active{
  background:linear-gradient(90deg,#00eaff 0%,#19b3fe 100%);
  color:#02131f;box-shadow:0 0 18px rgba(0,239,255,0.4);
}
canvas{
  width:100%!important;
  height:auto!important;
  aspect-ratio:16/9;
  display:block;
}
.summary{text-align:center;color:#77dfff;margin-top:12px;font-size:0.9rem;}

/* ===== Small Screen ===== */
@media (max-width:400px){
  body{font-size:0.95rem;}
  .dashboard{padding:14px;}
  .link{font-size:0.85rem;}
}
</style>
</head>

<body>
<h1>🛰 JTT Alliance Management V3.5 🛰</h1>

<div class="dashboard">
  <div class="section">
    <h2>SHEET : ALLIANCE STATS</h2>
    <p style="text-align:center">Member census tracking. Data auto‑updated.</p>

    <div class="jauge-container">
      <div class="jauge-fill" id="fillBar"></div>
      <div class="jauge-text" id="fillText">Loading…</div>
    </div>

    <p style="text-align:center">
      <strong>Registered Members :</strong> <span id="count">--</span> / <span id="total">--</span>
    </p>

    <div class="submenu">
      <a class="link" href="https://forms.gle/VSXaijct8ebQFnYx5" target="_blank">📋 New Registration</a>
      <a class="link" href="https://docs.google.com/spreadsheets/d/1QMna4_NnamMeNUvU69dOOqwhIL07QgLlZ5mrKTU3xZs/edit?gid=483757800#gid=483757800" target="_blank">📊 JTT Data System</a>
      <a class="link" href="JTT_backup.html" target="_self">🎯 My Personal Link</a>
    </div>

    <button class="btn-sync" onclick="loadStats()">🔄 Refresh</button>
  </div>
</div>

<div class="dashboard">
  <div class="section">
    <h2>📈 GAME TIME MODELIZED – BROTHER IN ARM + SUM WAR POWER</h2>
    <div class="tabs">
      <button class="tab active" id="weeklyBtn">WEEKLY</button>
      <button class="tab" id="voidBtn">VOID</button>
    </div>
    <canvas id="chart"></canvas>
    <div class="summary" id="summary">Loading data...</div>
  </div>
</div>

<footer>© JTT Alliance Management V3.5</footer>

<script>
/* --- Alliance bar --- */
async function loadStats(){
  try{
    const res=await fetch(`https://docs.google.com/spreadsheets/d/1QMna4_NnamMeNUvU69dOOqwhIL07QgLlZ5mrKTU3xZs/gviz/tq?tqx=out:csv&gid=1508042555`);
    const text=await res.text();
    const rows=text.trim().split("\n").map(r=>r.split(",").map(c=>c.replace(/(^"|"$)/g,"")));
    const nums=(rows[1]||[]).filter(x=>/^[0-9]+$/.test(x));
    const cur=parseInt(nums[0]||"0"), tot=parseInt(nums[1]||"1");
    const pct=Math.min(Math.round((cur/tot)*100),100);
    fillBar.style.width=pct+"%";
    fillText.textContent=pct+"% completed";
    count.textContent=cur; total.textContent=tot;
  }catch{fillText.textContent="❌ Error";}
}
loadStats();

/* --- Chart --- */
const ctx=document.getElementById('chart').getContext('2d');
const D={weekly:{power:[],players:[]},void:{power:[],players:[]}};
const grad=ctx.createLinearGradient(0,0,0,200);
grad.addColorStop(0,"rgba(0,255,255,0.25)");
grad.addColorStop(1,"rgba(0,255,255,0)");
const chart=new Chart(ctx,{
  type:'line',
  data:{
    labels:Array.from({length:25},(_,i)=>i<24?`${i}h`:"24h"),
    datasets:[
      {label:"💪🌐 Sum War Power (M)",data:[],
       borderColor:'#00ffee',backgroundColor:grad,fill:true,tension:0.35,
       borderWidth:3,pointRadius:3,pointBackgroundColor:'#00ffe0',yAxisID:'y'},
      {label:"👥 Brothers in Arm (Players)",data:[],
       borderColor:'#00cfff',backgroundColor:"rgba(0,255,255,0.08)",fill:true,
       tension:0.35,borderWidth:2,pointRadius:3,yAxisID:'y1'}
    ]
  },
  options:{
    responsive:true,maintainAspectRatio:true,
    interaction:{mode:'index',intersect:false},
    plugins:{legend:{labels:{color:'#00eaff',font:{size:10}}}},
    scales:{
      y:{beginAtZero:true,ticks:{color:'#00ffff'},grid:{color:'rgba(0,255,255,0.05)'}},
      y1:{position:'right',beginAtZero:true,ticks:{color:'#00ffff'},grid:{drawOnChartArea:false}},
      x:{ticks:{color:'#66eaff'},grid:{color:'rgba(0,255,255,0.05)'}}
    }
  }
});
function glow(){const g=7+5*Math.sin(Date.now()/400);ctx.canvas.style.boxShadow=`0 0 ${g}px #00eaff`;requestAnimationFrame(glow);}glow();

/* --- Fetch Google data --- */
async function rangeFetch(gid,range){
  const url=`https://docs.google.com/spreadsheets/d/1QMna4_NnamMeNUvU69dOOqwhIL07QgLlZ5mrKTU3xZs/gviz/tq?tqx=out:json&gid=${gid}&range=${range}`;
  const res=await fetch(url);const txt=await res.text();
  const json=JSON.parse(txt.substring(47).slice(0,-2));
  return json.table.rows[0].c.map(c=>parseFloat(String(c?.v??0).replace(',','.'))||0);
}
async function loadData(){
  const [w,v]=await Promise.all([
    Promise.all([rangeFetch(0,'C127:AA127'),rangeFetch(0,'C189:AA189')]),
    Promise.all([rangeFetch(1434850621,'C127:AA127'),rangeFetch(1434850621,'C189:AA189')])
  ]);
  D.weekly={players:w[0],power:w[1].map(p=>p/1_000_000)};
  D.void={players:v[0],power:v[1].map(p=>p/1_000_000)};
  setData('weekly');
}
function setData(type){
  chart.data.datasets[0].data=D[type].power;
  chart.data.datasets[1].data=D[type].players;
  chart.update();
}
weeklyBtn.onclick=()=>{weeklyBtn.classList.add('active');voidBtn.classList.remove('active');setData('weekly');};
voidBtn.onclick=()=>{voidBtn.classList.add('active');weeklyBtn.classList.remove('active');setData('void');};
loadData();

/* --- Register Service Worker --- */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>
</body>
</html>
